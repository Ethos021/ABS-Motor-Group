// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum VehicleStatus {
  AVAILABLE
  RESERVED
  SOLD
  IN_TRANSIT
}

model Dealer {
  id        Int       @id @default(autoincrement())
  name      String
  email     String?
  phone     String?
  address   String?
  city      String?
  state     String?
  country   String?
  vehicles  Vehicle[]
  sales     Sale[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("dealers")
  @@index([city])
  @@index([state])
  @@index([country])
}

model Vehicle {
  id           Int            @id @default(autoincrement())
  vin          String?        @unique
  stockNumber  String?        @unique @map("stock_number")
  make         String
  model        String
  year         Int
  price        Decimal        @db.Decimal(10, 2)
  mileage      Int?
  status       VehicleStatus  @default(AVAILABLE)
  bodyType     String?        @map("body_type")
  fuelType     String?        @map("fuel_type")
  transmission String?
  color        String?
  dealerId     Int?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  dealer Dealer? @relation(fields: [dealerId], references: [id], onDelete: SetNull)
  sales  Sale[]

  @@map("vehicles")
  @@index([make])
  @@index([model])
  @@index([year])
  @@index([status])
  @@index([dealerId])
}

model Customer {
  id        Int      @id @default(autoincrement())
  firstName String   @map("first_name")
  lastName  String   @map("last_name")
  email     String?  @unique
  phone     String?
  notes     String?
  sales     Sale[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("customers")
  @@index([lastName])
  @@index([email])
}

model Sale {
  id         Int      @id @default(autoincrement())
  vehicleId  Int
  customerId Int
  dealerId   Int?
  saleDate   DateTime @default(now()) @map("sale_date")
  salePrice  Decimal  @db.Decimal(10, 2) @map("sale_price")
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  vehicle  Vehicle  @relation(fields: [vehicleId], references: [id])
  customer Customer @relation(fields: [customerId], references: [id])
  dealer   Dealer?  @relation(fields: [dealerId], references: [id], onDelete: SetNull)

  @@map("sales")
  @@index([vehicleId])
  @@index([customerId])
  @@index([dealerId])
  @@index([saleDate])
}
